<%#
 Copyright (c) 2018, Tano Systems. All Rights Reserved.
 Anton Kikin <a.kikin@tano-systems.com>
-%>

<%+header%>

<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
<script type="text/javascript">//<![CDATA[

	function add_iface_row(i, table, key, obj)
	{
		var tr = table.rows[0].parentNode.insertRow(-1);
		    tr.className = 'cbi-section-table-row cbi-rowstyle-' + (1 + (i % 2));

		tr.insertCell(-1).innerHTML = "<strong>" + key + "</strong>";
		tr.insertCell(-1).innerHTML = obj.tx.tx;
		tr.insertCell(-1).innerHTML = obj.rx.rx;
		tr.insertCell(-1).innerHTML = obj.rx_discarded_cnt.rx_discarded_cnt;
		tr.insertCell(-1).innerHTML = obj.rx_unrecognized_cnt.rx_unrecognized_cnt;
		tr.insertCell(-1).innerHTML = obj.ageout_cnt.ageout_cnt;
		tr.insertCell(-1).innerHTML = obj.insert_cnt.insert_cnt;
		tr.insertCell(-1).innerHTML = obj.delete_cnt.delete_cnt;
	}

	XHR.poll(5, '<%=url('admin/services/lldpd/statistics_request')%>', null,
		function(x, json)
		{
			var counters_table =
				document.getElementById('counters');

			var ifaces = json.lldp.interface;

			// Clear table
			while (counters_table.rows.length > 1)
				counters_table.rows[0].parentNode.deleteRow(-1);

			if (Array.isArray(ifaces))
			{
				var j = 0;
				for (var i = 0; i < ifaces.length; i++)
				{
					for (var iface in ifaces[i])
					{
						add_iface_row(j, counters_table, iface, ifaces[i][iface])
						j++;
					}
				}
			}
			else
			{
				var i = 0;
				for (var iface in ifaces)
				{
					add_iface_row(i, counters_table, iface, ifaces[iface])
					i++;
				}
			}
		}
	)
//]]></script>

<h2 name="content"><%:LLDPd: Statistics%></h2>
<div class="cbi-map-descr">This page allows you to see detected neighbors by lldpd</div>

<fieldset class="cbi-section" id="cbi-table-table">
	<legend><%:Counters%></legend>

	<div class="cbi-section-node">
		<table class="cbi-section-table" id="counters">
			<tr class="cbi-section-table-titles">
				<th class="cbi-section-table-cell"><%:Interface%></th>
				<th class="cbi-section-table-cell"><%:Tx%></th>
				<th class="cbi-section-table-cell"><%:Rx%></th>
				<th class="cbi-section-table-cell"><%:Rx discarded%></th>
				<th class="cbi-section-table-cell"><%:Rx unrecognized%></th>
				<th class="cbi-section-table-cell"><%:Ageout count%></th>
				<th class="cbi-section-table-cell"><%:Insert count%></th>
				<th class="cbi-section-table-cell"><%:Delete count%></th>
			</tr>
			<tr><td colspan="8"><em><%:Collecting data...%></em></td></tr>
		</table>
	</div>

</fieldset>

<%+footer%>
