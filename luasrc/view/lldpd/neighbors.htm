<%#
 Copyright (c) 2018, Tano Systems. All Rights Reserved.
 Anton Kikin <a.kikin@tano-systems.com>
-%>

<%+header%>

<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
<script type="text/javascript">//<![CDATA[

	XHR.poll(5, '<%=url('admin/services/lldpd/neighbors_request')%>', null,
		function(x, json)
		{
			var nb_table =
				document.getElementById('neighbors');

			var ifaces = json.lldp.interface;

			// Clear table
			while (nb_table.rows.length > 1)
				nb_table.rows[0].parentNode.deleteRow(-1);

			var i = 0;
			for (var iface in ifaces)
			{
				var c = ifaces[iface];
				var inner;

				var tr = nb_table.rows[0].parentNode.insertRow(-1);
				    tr.className = 'cbi-section-table-row cbi-rowstyle-' + (1 + (i % 2));

				// Interface
				tr.insertCell(-1).innerHTML = "<strong>" + iface + "</strong>";

				// Protocol
				if (typeof c.via !== 'undefined')
					inner = c.via;
				else
					inner = "";

				tr.insertCell(-1).innerHTML = inner;

				// Age
				if (typeof c.age !== 'undefined')
					inner = c.age;
				else
					inner = "";

				tr.insertCell(-1).innerHTML = inner;

				// Chassis
				inner = "";

				for (var chassis in c.chassis)
				{
					var ch = c.chassis[chassis];

					inner += "<strong>Chassis:</strong>";
					inner += "<ul>";
					inner += "<li><strong>Name:</strong>&nbsp;" + chassis + '</li>';

					if (typeof ch.descr !== 'undefined')
						inner += "<li><strong>Description:</strong>&nbsp;" + ch.descr + "</li>";

					if (typeof ch.id.value !== 'undefined')
						inner += "<li><strong>ID:</strong>&nbsp;" + ch.id.value.toUpperCase() + "</li>";

					if (typeof ch.id.type !== 'undefined')
						inner += "<li><strong>ID type:</strong>&nbsp;" + ch.id.type.toUpperCase() + "</li>";

					if ((typeof ch["mgmt-ip"] !== 'undefined') && (ch["mgmt-ip"].length > 0))
					{
						inner += "<li><strong>Management addresses:</strong><ul>";

						for (var ip = 0; ip < ch["mgmt-ip"].length; ip++)
							inner += "<li>" + ch["mgmt-ip"][ip] + "</li>";

						inner += "</ul></li>";
					}

					if ((typeof ch.capability !== 'undefined') && (ch.capability.length > 0))
					{
						inner += "<li><strong>Capabilities:</strong><ul>";

						for (var cap = 0; cap < ch.capability.length; cap++)
						{
							inner += "<li><strong>" + ch.capability[cap].type + ":</strong>&nbsp;";
							inner += ch.capability[cap].enabled ? "Enabled" : "Disabled";
							inner += "</li>";
						}

						inner += "</ul></li>";
					}

					inner += "</ul>";
				}

				inner += "<strong>Port:</strong>";
				inner += "<ul>";

				if (typeof c.port.descr !== 'undefined')
					inner += "<li><strong>Description:</strong>&nbsp;" + c.port.descr + "</li>";

				if (typeof c.port.id.value !== 'undefined')
					inner += "<li><strong>ID:</strong>&nbsp;" + c.port.id.value.toUpperCase() + "</li>";

				if (typeof c.port.id.type !== 'undefined')
					inner += "<li><strong>ID type:</strong>&nbsp;" + c.port.id.type.toUpperCase() + "</li>";

				if (typeof c.port.ttl !== 'undefined')
					inner += "<li><strong>TTL:</strong>&nbsp;" + c.port.ttl + "</li>";

				inner += "</ul>";

				tr.insertCell(-1).innerHTML = inner;

				i++;
			}
		}
	)
//]]></script>

<h2 name="content"><%:LLDPd: Neighbors%></h2>
<div class="cbi-map-descr">This page allows you to see detected neighbors by LLDPd</div>

<fieldset class="cbi-section" id="cbi-table-table">
	<legend><%:LLDPd neighbors%></legend>

	<div class="cbi-section-node">
		<table class="cbi-section-table" id="neighbors">
			<tr class="cbi-section-table-titles">
				<th class="cbi-section-table-cell"><%:Interface%></th>
				<th class="cbi-section-table-cell"><%:Protocol%></th>
				<th class="cbi-section-table-cell"><%:Age%></th>
				<th class="cbi-section-table-cell"><%:Chassis and port%></th>
			</tr>
			<tr><td colspan="4"><em><%:Collecting data...%></em></td></tr>
		</table>
	</div>

</fieldset>

<%+footer%>
